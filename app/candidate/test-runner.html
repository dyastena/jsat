<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Runner - J-SAT</title>
    <link href="../../dist/output.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-950 text-gray-100 font-sans antialiased">
    <div class="min-h-screen p-6">
        <header class="flex items-center justify-between mb-6">
            <div>
                <h1 class="text-3xl lg:text-4xl font-bold">Test Runner</h1>
                <p class="text-sm text-gray-400">Answer questions, run code, and submit when ready.</p>
            </div>
            <div class="flex items-center gap-4">
                <a href="exam.html" class="px-4 py-2 rounded-lg bg-gray-800 text-gray-200 hover:bg-gray-700">Back to Dashboard</a>
                <div id="timer" class="text-lg font-semibold text-emerald-400">00:00:00</div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Question panel -->
            <section class="lg:col-span-1 bg-gray-900 rounded-xl p-6 shadow-md">
                <div class="flex items-center justify-between mb-4">
                    <div class="text-lg font-semibold">Question</div>
                    <div id="progress" class="text-sm text-gray-400">Question 1 of 1</div>
                </div>
                <div id="question-panel" class="prose max-w-none text-gray-100"></div>
                <div class="mt-6 flex items-center gap-3">
                    <button id="prevBtn" class="px-3 py-2 rounded-md bg-gray-800 text-gray-200 hover:bg-gray-700">Previous</button>
                    <button id="nextBtn" class="px-3 py-2 rounded-md bg-gray-800 text-gray-200 hover:bg-gray-700">Next</button>
                </div>
            </section>

            <!-- Code editor -->
            <section class="lg:col-span-2 bg-gray-900 rounded-xl p-6 shadow-md flex flex-col">
                <div class="flex items-center justify-between mb-4">
                    <div class="text-lg font-semibold">Code Editor</div>
                    <div class="flex items-center gap-3">
                        <button id="runBtn" class="px-4 py-2 rounded-md bg-emerald-500 text-white font-semibold hover:bg-emerald-600">Run Code</button>
                        <button id="submitBtn" class="px-4 py-2 rounded-md bg-blue-600 text-white font-semibold hover:bg-blue-700">Submit</button>
                    </div>
                </div>

                <textarea id="editor" class="flex-1 w-full min-h-[260px] bg-gray-800 text-white p-4 rounded-lg font-mono text-sm lg:text-base" placeholder="Write your code here..."></textarea>

                <div class="mt-4">
                    <div class="text-sm text-gray-400 mb-2">Output Console</div>
                    <pre id="console" class="bg-black bg-opacity-40 text-gray-100 p-4 rounded-lg h-40 overflow-auto text-sm"></pre>
                </div>
            </section>
        </main>

        <script>
            // Frontend-only runner: all network/backend functions removed.
            // This script provides a mocked experience for authoring and UI testing.
            lucide.createIcons();

            const mockInstance = {
                id: 'mock-1',
                durationMinutes: 30,
                questions: [
                    { id: 1, title: 'Sum of two numbers', body: 'Write a function that returns the sum of two numbers.', starter: '// e.g. function solve(a,b) { return a+b }' },
                    { id: 2, title: 'Reverse string', body: 'Return the reversed string.', starter: "// e.g. function solve(s) { return s.split('').reverse().join('') }" }
                ],
                currentQuestionIndex: 0
            };

            // Minimal timer display (no auto-submit)
            function displayTimer(minutes) {
                const timerEl = document.getElementById('timer');
                const mm = String(Math.floor(minutes)).padStart(2,'0');
                timerEl.textContent = `${mm}:00:00`;
            }

            // Render question
            let instance = mockInstance;
            function renderQuestion() {
                const q = instance.questions[instance.currentQuestionIndex];
                document.getElementById('question-panel').innerHTML = `
                    <h2 class="text-lg font-semibold">${q.title}</h2>
                    <div class="mt-2 text-sm text-gray-300">${q.body}</div>
                `;
                document.getElementById('progress').textContent = `Question ${instance.currentQuestionIndex+1} of ${instance.questions.length}`;
                const editor = document.getElementById('editor');
                if (!editor.value.trim()) editor.value = q.starter || '';
            }

            document.getElementById('prevBtn').addEventListener('click', () => {
                if (instance.currentQuestionIndex > 0) {
                    instance.currentQuestionIndex -= 1; renderQuestion();
                }
            });
            document.getElementById('nextBtn').addEventListener('click', () => {
                if (instance.currentQuestionIndex < instance.questions.length - 1) {
                    instance.currentQuestionIndex += 1; renderQuestion();
                }
            });

            // Run (simulated): produce a friendly, deterministic output for common patterns
            document.getElementById('runBtn').addEventListener('click', () => {
                const code = document.getElementById('editor').value || '';
                const consoleEl = document.getElementById('console');
                consoleEl.textContent = 'Simulated run:\n';

                // Heuristic: simple addition like "2+3"
                const addMatch = code.match(/(\d+)\s*\+\s*(\d+)/);
                if (addMatch) {
                    const a = parseInt(addMatch[1],10), b = parseInt(addMatch[2],10);
                    consoleEl.textContent += `Compilation: OK\nOutput:\n${a + b}\nExit code: 0`;
                    return;
                }

                // Heuristic: System.out.println('literal') for Java
                const printlnMatch = code.match(/System\.out\.println\s*\(\s*(["'])(.*?)\1\s*\)/s);
                if (printlnMatch) {
                    consoleEl.textContent += `Compilation: OK\nOutput:\n${printlnMatch[2]}\nExit code: 0`;
                    return;
                }

                // Default simulated message
                consoleEl.textContent += 'Compilation: OK\nOutput:\n[Simulated] No backend available to execute code.\nTo enable real execution, add a server-side runner (Judge0 or a sandbox).';
            });

            // Submit (simulated): navigate back to dashboard with a message
           

            // Init
            (function init() {
                renderQuestion();
                displayTimer(instance.durationMinutes || 30);
            })();
        </script>
    </div>
</body>
</html>
